# 일일 활동 리포트 (/lean-kit:daily-report)

Claude CLI 세션 데이터를 수집·분석하여 한국어 일일 활동 리포트를 자동 생성합니다.

출력 위치: `~/.claude/daily-reports/{YYYY-MM-DD}/report.md`

- Node.js 스크립트로 JSONL 세션 데이터를 파싱 (LLM 토큰 소비 0)
- Generator-Critic 루프로 정확도 검증 (100점 만점에서 감점 방식 평가)
- 9개 섹션 구성: 개요, 일감 상세, 메타데이터, 비용 분석, 세션 흐름, 키워드, 도구 사용, 트렌드, 개선 제안

## 빠른 시작

```
/lean-kit:daily-report              # 어제 날짜 리포트 생성
/lean-kit:daily-report 2026-02-25   # 특정 날짜 지정
일일 리포트 생성해줘                   # 키워드 트리거 (UserPromptSubmit 훅)
```

## 리포트 구성

| 섹션 | 이름 | 설명 | 주요 내용 |
|------|------|------|-----------|
| 1 | 개요 | 핵심 지표 요약 | 세션 수, 활동 시간, 커밋 수, 토큰, 비용 |
| 2 | 일감 상세 | 프로젝트별 작업 내역 | 작업 목표, 세션 흐름 다이어그램, 커밋 목록, 주요 이벤트 |
| 3 | 메타데이터 | 전체 세션 타임라인 | 시작/종료/소요시간/프로젝트/비용 표 |
| 4 | 토큰 & 비용 분석 | 비용 상세 분석 | 토큰 분포, 프로젝트별 비용, 비용 효율, 캐시 효율 |
| 5 | 세션 흐름 | 세션 간 연결 관계 | 프로젝트 전환 타임라인, 연결 패턴, 시간대별 집중도 |
| 6 | 키워드 분석 | 프롬프트 분석 | 빈출 키워드, 작업 유형 분류, 프롬프트 패턴 |
| 7 | 도구 사용 분석 | 자동화 & 도구 활용 | 도구 빈도, 서브에이전트, 슬래시 커맨드, 훅 |
| 8 | 트렌드 비교 | 이전 리포트 대비 변화 | 주요 지표 비교 (↑/↓), 베이스라인 기록 |
| 9 | 개선 제안 | 데이터 기반 제안 | 프롬프트/워크플로우/도구/비용 4개 영역 |

## 동작 순서

```
Phase 0: 데이터 수집                Phase 1: Generator-Critic 루프        Phase 2: 최종 출력
─────────────────────              ──────────────────────────────       ─────────────────
┌─────────────────┐                ┌──────────────────┐                ┌───────────────┐
│ 날짜 결정       │                │ Generator(sonnet)│                │ 최종 리포트   │
│ (기본: 어제)    │                │ 리포트 초안 생성 │                │ 파일 저장     │
└────────┬────────┘                └────────┬─────────┘                └───────┬───────┘
         ▼                                  ▼                                  ▼
┌─────────────────┐                ┌──────────────────┐                ┌───────────────┐
│ 기존 리포트     │                │ Critic (sonnet)  │                │ 임시 파일     │
│ 존재 확인       │                │ 정확도 검증      │                │ 정리          │
└────────┬────────┘                └────────┬─────────┘                └───────┬───────┘
         ▼                                  ▼                                  ▼
┌─────────────────┐                ┌──────────────────┐                ┌───────────────┐
│ Node.js 스크립트│       ┌───NO───│ 점수 ≥ 80?       │                │ 요약 출력     │
│ 세션 데이터 수집│       │        └────────┬─────────┘                └───────────────┘
└────────┬────────┘       ▼                 │YES
         ▼          [피드백 반영]            ▼
┌─────────────────┐  (최대 2회)       [Phase 2로]
│ JSON 저장       │
└────────┬────────┘
         ▼
┌─────────────────┐
│ 이전 리포트     │
│ 탐색 (트렌드)   │
└─────────────────┘
```

**Generator**: `air-claudecode:software-engineer` 서브에이전트(Sonnet)로 세션 JSON + 리포트 템플릿 + 베스트 프랙티스 기반 한국어 리포트 초안 생성

**Critic**: `air-claudecode:software-engineer` 서브에이전트(Sonnet)로 100점 만점 감점 기반 평가 (5개 카테고리)

| 카테고리 | 배점 | 평가 항목 |
|----------|------|-----------|
| 데이터 정확도 | 35점 | 토큰/비용/세션 수/커밋 수가 JSON과 일치하는지 |
| 완전성 | 25점 | 9개 섹션 모두 존재하고 실질적 내용이 있는지 |
| 수치 일관성 | 20점 | 리포트 내부 숫자가 서로 일치하는지 |
| 분석 품질 | 10점 | 개선 제안이 데이터에 기반하는지 |
| 형식 & 가독성 | 10점 | 마크다운 테이블, 넘버링, 한국어 본문 |

| 점수 | 판정 | 액션 |
|------|------|------|
| ≥80 | PASS | 최종 출력으로 진행 |
| 60–79 | REVISE | 피드백 반영 후 재생성 (최대 2회) |
| <60 | FAIL | 사용자에게 알림 |

## 출력 예시

> 아래는 2026-02-25 리포트(`docs/daily-reports/2026-02-25/report.md`)에서 실제 발췌한 내용입니다.

<details>
<summary>섹션 1 — 개요 테이블</summary>

| 항목 | 값 |
|------|-----|
| **총 세션** | 30개 (메인 26 + 팀워커 2 + 빈세션 2) |
| **활동 시간** | 10:11 ~ 20:02 KST (약 10시간) |
| **총 커밋** | 13개 |
| **활동 프로젝트** | 4개 |
| **총 토큰** | 141.0M (입력 85.8K + 출력 326.3K + 캐시읽기 124.0M + 캐시생성 16.6M) |
| **추정 비용** | **$273.93** |
| **모델** | claude-opus-4-6 (전 세션 공통) |

</details>

<details>
<summary>섹션 2.1 — 일감 상세 (air-labs-insurance 발췌)</summary>

**작업 목표**: 멀티모듈 → 단일모듈 통합, IntelliJ Gradle 모듈 중복 해결, 디렉토리명 표준화

**세션 흐름**:
```
158369c9 (2/24 carry-over ~ 10:26)  Insurance 독립 모듈 구현
    │
    ├─ 1d0bf085 (10:26 ~ 15:43)  단일 모듈 재구조화 + OpenAPI [오케스트레이터]
    │   ├─ 986f5ebc (10:31 ~ 10:38)  [워커: build-engineer]
    │   └─ 732a3de2 (10:31 ~ 10:38)  [워커: source-engineer]
    │
    ├─ 01ee3a45 (15:43 ~ 16:31)  Gradle 모듈 중복 제거 1차
    ├─ 95425872 (16:32 ~ 16:59)  Gradle 모듈 중복 제거 2차
    ├─ 02168c7e (16:59 ~ 17:13)  Gradle 모듈 중복 제거 3차 → 해결
    └─ 458ca449 (17:13 ~ 17:14)  논리 단위 커밋 분리 + PR 생성
```

**커밋 (4개)**:

| 해시 | 메시지 |
|------|--------|
| `1e2bec1` | refactor: insurance 멀티모듈 → air-insurance 단일모듈 통합 |
| `247d286` | rename: mono-repo → air-mono 디렉토리명 통일 |
| `1df736b` | rename: demo → air-demo 디렉토리명 통일 |
| `e31a7d0` | chore: .gitignore에서 .idea 설정 파일 선택적 허용 |

| 항목 | 값 |
|------|-----|
| 세션 수 | 10 (메인 8 + 워커 2) |
| 토큰 | 39.5M |
| 비용 | $80.33 |

</details>

<details>
<summary>섹션 4 — 비용 분석 (토큰 분포 + 프로젝트별 비용 + 캐시 효율)</summary>

**4.1 전체 토큰 분포**:

| 토큰 유형 | 수량 | 비용 | 비율 |
|-----------|------|------|------|
| Non-cached Input | 85,824 | $1.29 | 0.5% |
| Cache Creation | 16,564,810 | $62.12 | 22.7% |
| Cache Read | 124,030,487 | $186.05 | 67.9% |
| Output | 326,301 | $24.47 | 8.9% |
| **합계** | **141,007,422** | **$273.93** | 100% |

**4.2 프로젝트별 비용**:

```
air-labs         ████████████████████████████████████  $141.21 (51.5%)
insurance        ████████████████████           $80.33 (29.3%)
air-claudecode   ████████████                   $49.46 (18.1%)
mrt-eugene-docs  █                               $2.93 ( 1.1%)
```

**4.4 캐시 효율**:

| 지표 | 값 |
|------|-----|
| 캐시 히트율 | 88.2% |
| 캐시 미적용 가정 비용 | $2,110.22 |
| 실제 입력 비용 | $249.46 |
| 캐시 절감액 | **$1,860.76** (88.2% 비용 절감) |

</details>

<details>
<summary>섹션 9.4 — 개선 제안 (비용 최적화)</summary>

1. **모델 티어링**: 문서 작성/커밋 분리 같은 단순 작업은 Sonnet 4.6이나 Haiku를 활용하면 비용 절감 가능 (현재 전 세션 Opus 4.6 사용).

2. **Context 관리**: 캐시 비용($248.17)이 전체의 90.6%를 차지. 세션 중간에 `/clear`로 불필요한 context를 정리하면 캐시 비용 절감 가능.

3. **추정 일일 예산 대비**: $273.93/일은 연간 약 $100K 수준. 프로젝트 수와 작업 강도를 고려한 예산 관리 필요.

</details>

## 데이터 수집 원리

### JSONL 파싱

`~/.claude/projects/` 하위 JSONL 파일을 line-by-line 파싱, `assistant`/`user` 이벤트에서 토큰/도구/프롬프트를 추출합니다.

### KST 타임존 처리

- 모든 타임스탬프를 KST(UTC+9)로 변환
- 날짜 범위: KST 00:00:00 ~ 23:59:59.999
- Carry-over 세션: 전날 시작~당일 종료한 세션도 포함 (시간 범위가 겹치면 포함)

### 토큰/비용 계산

- Claude API usage 필드는 상호 배타적 (input, output, cacheRead, cacheCreate)
- 비용 = Σ(각 토큰 유형 × 모델별 단가)

| 모델 | Input (/1M) | Output (/1M) | Cache Read (/1M) | Cache Create (/1M) |
|------|-------------|--------------|-------------------|--------------------|
| claude-opus-4-6 | $15.00 | $75.00 | $1.50 | $3.75 |
| claude-sonnet-4-6 | $3.00 | $15.00 | $0.30 | $3.75 |
| claude-haiku-4-5 | $0.80 | $4.00 | $0.08 | $1.00 |

### 커밋 탐지

Bash 도구 결과에서 git commit 출력 패턴 매칭

- 정규식: `\[[\w/.-]+\s+([a-f0-9]{7,40})\]\s+(.+)`
- 예: `[main abc1234] feat: add new feature`

### 프로젝트명 추출

디렉토리 경로에서 의미 있는 세그먼트를 추출합니다.

- `-Users-username-IdeaProjects-org-project` → `org/project`

### 세션 분류

| 타입 | 조건 | 설명 |
|------|------|------|
| main | 기본값 | 사용자가 직접 시작한 일반 세션 |
| worker | SendMessage 도구 사용 | TeamCreate로 생성된 팀 워커 세션 |
| empty | 프롬프트·도구 사용 없음 | 실질 활동이 없는 빈 세션 |

## 비용 & 성능

- Generator/Critic 모두 Sonnet 사용 (Opus 대비 5배 저렴)
- 데이터 수집: Node.js 스크립트 — LLM 토큰 소비 0, 순수 파일 I/O
- 예상 비용: Sonnet 기준 **~$1–3/회** (세션 데이터 크기에 비례, 대규모 세션의 경우 초과 가능)
- Generator-Critic 반복 최대 2회로 제한하여 비용 통제

## 주의사항

- **KST 기준**: 모든 날짜/시간은 한국 표준시(UTC+9) 기준
- **최소 1개 세션 필요**: 해당 날짜에 세션 데이터가 없으면 리포트를 생성하지 않고 안내 메시지 출력
- **Carry-over 세션**: 전날 시작~당일 종료한 세션은 해당일 리포트에 포함됨. 토큰/비용에 전날 분량이 포함될 수 있음
- **기존 리포트 덮어쓰기**: 같은 날짜의 리포트가 이미 있으면 덮어쓰기 여부를 확인
- **Node.js 필요**: 데이터 수집 스크립트 실행에 Node.js 런타임 필요
- **로컬 전용**: 로컬 Claude Code 세션 데이터(`~/.claude/projects/`)를 기반으로 동작합니다. CI/CD 또는 원격 환경에서는 세션 데이터가 없을 수 있습니다

## FAQ

| 질문 | 답변 |
|------|------|
| 세션이 없으면? | 데이터 수집 스크립트가 빈 결과를 반환하면, 오케스트레이터가 세션 수 0을 감지하여 안내 후 종료합니다. |
| 비용은 얼마나? | Generator/Critic 모두 Sonnet 사용, 1회 실행당 ~$1–3 수준입니다. |
| 캐리오버 세션이란? | 전날 시작되어 당일까지 이어진 세션입니다. 해당일 리포트에 포함되며, 토큰/비용에 전날 분량이 포함됩니다. |
| 스크립트만 단독 실행 가능? | `node plugins/lean-kit/scripts/collect-session-data.mjs [YYYY-MM-DD]` 로 JSON 데이터만 추출할 수 있습니다. |
| 리포트 커스터마이징? | 생성된 `report.md`를 직접 편집할 수 있습니다. 리포트 템플릿 수정은 `references/report-template.md`를 편집하세요. |
| 이전 리포트와 비교? | Section 8에서 자동으로 이전 리포트와 트렌드를 비교합니다. 이전 리포트가 없으면 베이스라인으로 기록합니다. |

## 파일 구조

```
plugins/lean-kit/
├── skills/
│   └── daily-report/
│       ├── SKILL.md                           # 스킬 오케스트레이터 (동작 순서 정의)
│       ├── README.md                          # 이 문서
│       └── references/
│           ├── report-template.md             # 리포트 9개 섹션 템플릿
│           ├── quality-criteria.md            # Critic 평가 기준 (100점 감점제)
│           └── best-practices.md              # 개선 제안 참조 자료
├── agents/
│   ├── report-generator.md                    # Generator 에이전트 명세
│   └── report-critic.md                       # Critic 에이전트 명세
└── scripts/
    └── collect-session-data.mjs               # 데이터 수집 Node.js 스크립트
```

출력 디렉토리:

```
~/.claude/daily-reports/
└── {YYYY-MM-DD}/
    └── report.md                              # 생성된 최종 리포트
```
